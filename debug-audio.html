<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audionyx ìŒì› ë””ë²„ê·¸ ë„êµ¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .debug-section {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #3eb489;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #1a5634; border: 1px solid #3eb489; }
        .status.error { background: #5c1a1a; border: 1px solid #ff4444; }
        .status.warning { background: #5c4a1a; border: 1px solid #ffa500; }
        .status.info { background: #1a3a5c; border: 1px solid #4499ff; }
        button {
            background: #3eb489;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2a9d69; }
        button:disabled { background: #666; cursor: not-allowed; }
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .audio-test {
            border: 1px solid #666;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        .waveform-container {
            height: 60px;
            background: #333;
            border-radius: 4px;
            margin: 10px 0;
            position: relative;
        }
    </style>
</head>
<body>
    <h1>ğŸµ Audionyx ìŒì› ë””ë²„ê·¸ ë„êµ¬</h1>
    <p>ìŒì› ì¬ìƒ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ê³  í•´ê²°í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.</p>

    <div class="debug-section">
        <h2>1. ê¸°ë³¸ í™˜ê²½ ì²´í¬</h2>
        <button onclick="checkEnvironment()">í™˜ê²½ ê²€ì‚¬</button>
        <div id="env-results"></div>
    </div>

    <div class="debug-section">
        <h2>2. Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testFirebaseConnection()">Firebase ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <div id="firebase-results"></div>
    </div>

    <div class="debug-section">
        <h2>3. Storage íŒŒì¼ ëª©ë¡ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testStorageFiles()">Storage íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
        <div id="storage-results"></div>
    </div>

    <div class="debug-section">
        <h2>4. ìŒì› ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testAudioDownload()">ìŒì› URL í…ŒìŠ¤íŠ¸</button>
        <div id="audio-download-results"></div>
    </div>

    <div class="debug-section">
        <h2>5. WaveSurfer í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testWaveSurfer()">WaveSurfer ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
        <div id="wavesurfer-results"></div>
        <div id="waveform-test" class="waveform-container"></div>
    </div>

    <div class="debug-section">
        <h2>6. ì§ì ‘ ì˜¤ë””ì˜¤ ì¬ìƒ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testDirectAudio()">HTML5 Audio í…ŒìŠ¤íŠ¸</button>
        <div id="direct-audio-results"></div>
    </div>

    <!-- Firebase ë° ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js';
        import { getStorage, ref, listAll, getDownloadURL } from 'https://www.gstatic.com/firebasejs/11.7.1/firebase-storage.js';
        import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js';
        import WaveSurfer from 'https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.esm.js';

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyBP926ULg9wNUNGjQy0fMjRxUeS4XyeG6M",
            authDomain: "audionyx-a7b2e.firebaseapp.com",
            projectId: "audionyx-a7b2e",
            storageBucket: "audionyx-a7b2e.firebasestorage.app",
            messagingSenderId: "1002069862376",
            appId: "1:1002069862376:web:669c93bca8ab2f1d09665d",
            measurementId: "G-P6GNNYLJ38"
        };

        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        const db = getFirestore(app);

        // ì „ì—­ìœ¼ë¡œ ë…¸ì¶œí•˜ì—¬ ë²„íŠ¼ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•¨
        window.storage = storage;
        window.db = db;
        window.getDownloadURL = getDownloadURL;
        window.ref = ref;
        window.listAll = listAll;
        window.collection = collection;
        window.getDocs = getDocs;
        window.WaveSurfer = WaveSurfer;

        console.log('ğŸš€ Firebase ë° ëª¨ë“ˆ ì´ˆê¸°í™” ì™„ë£Œ');
    </script>

    <script>
        function addStatus(containerId, type, message) {
            const container = document.getElementById(containerId);
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.innerHTML = message;
            container.appendChild(status);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function checkEnvironment() {
            clearResults('env-results');
            
            // ë¸Œë¼ìš°ì € ì •ë³´
            addStatus('env-results', 'info', `
                <strong>ë¸Œë¼ìš°ì €:</strong> ${navigator.userAgent}<br>
                <strong>ì˜¨ë¼ì¸ ìƒíƒœ:</strong> ${navigator.onLine ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}<br>
                <strong>í˜„ì¬ URL:</strong> ${window.location.href}<br>
                <strong>í”„ë¡œí† ì½œ:</strong> ${window.location.protocol}<br>
                <strong>í˜¸ìŠ¤íŠ¸:</strong> ${window.location.host}
            `);

            // Audio ì§€ì› í™•ì¸
            const audio = new Audio();
            const supportedFormats = [];
            if (audio.canPlayType('audio/mpeg')) supportedFormats.push('MP3');
            if (audio.canPlayType('audio/wav')) supportedFormats.push('WAV');
            if (audio.canPlayType('audio/mp4')) supportedFormats.push('M4A');

            addStatus('env-results', 'success', `
                <strong>ì§€ì› ì˜¤ë””ì˜¤ í¬ë§·:</strong> ${supportedFormats.join(', ')}<br>
                <strong>Web Audio API:</strong> ${window.AudioContext ? 'ì§€ì›' : 'ë¯¸ì§€ì›'}<br>
                <strong>Fetch API:</strong> ${window.fetch ? 'ì§€ì›' : 'ë¯¸ì§€ì›'}
            `);

            // CORS í…ŒìŠ¤íŠ¸
            if (window.location.protocol === 'file:') {
                addStatus('env-results', 'warning', 'âš ï¸ file:// í”„ë¡œí† ì½œì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. CORS ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        async function testFirebaseConnection() {
            clearResults('firebase-results');
            
            try {
                addStatus('firebase-results', 'info', 'ğŸ” Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
                
                // Firestore ì—°ê²° í…ŒìŠ¤íŠ¸
                const testCollection = window.collection(window.db, 'track_new');
                const snapshot = await window.getDocs(testCollection);
                
                addStatus('firebase-results', 'success', `
                    âœ… Firestore ì—°ê²° ì„±ê³µ<br>
                    <strong>track_new ì»¬ë ‰ì…˜:</strong> ${snapshot.size}ê°œ ë¬¸ì„œ ë°œê²¬
                `);

                // Storage ì—°ê²° í…ŒìŠ¤íŠ¸
                const storageRef = window.ref(window.storage, '');
                addStatus('firebase-results', 'success', 'âœ… Firebase Storage ì—°ê²° ì„±ê³µ');

            } catch (error) {
                addStatus('firebase-results', 'error', `
                    âŒ Firebase ì—°ê²° ì‹¤íŒ¨<br>
                    <strong>ì˜¤ë¥˜:</strong> ${error.message}<br>
                    <pre>${error.stack}</pre>
                `);
            }
        }

        async function testStorageFiles() {
            clearResults('storage-results');
            
            try {
                addStatus('storage-results', 'info', 'ğŸ“ Storage íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ëŠ” ì¤‘...');
                
                // track í´ë” í™•ì¸
                const trackRef = window.ref(window.storage, 'track');
                const trackList = await window.listAll(trackRef);
                
                if (trackList.items.length > 0) {
                    addStatus('storage-results', 'success', `
                        âœ… track í´ë”ì—ì„œ ${trackList.items.length}ê°œ íŒŒì¼ ë°œê²¬<br>
                        <strong>ì²˜ìŒ 5ê°œ íŒŒì¼:</strong><br>
                        ${trackList.items.slice(0, 5).map(item => `â€¢ ${item.name}`).join('<br>')}
                    `);
                } else {
                    addStatus('storage-results', 'warning', 'âš ï¸ track í´ë”ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                    
                    // ë£¨íŠ¸ í´ë” í™•ì¸
                    const rootRef = window.ref(window.storage, '');
                    const rootList = await window.listAll(rootRef);
                    
                    const audioFiles = rootList.items.filter(item => {
                        const name = item.name.toLowerCase();
                        return name.endsWith('.mp3') || name.endsWith('.wav') || name.endsWith('.m4a');
                    });
                    
                    if (audioFiles.length > 0) {
                        addStatus('storage-results', 'info', `
                            ğŸ“ ë£¨íŠ¸ í´ë”ì—ì„œ ${audioFiles.length}ê°œ ì˜¤ë””ì˜¤ íŒŒì¼ ë°œê²¬<br>
                            ${audioFiles.slice(0, 5).map(item => `â€¢ ${item.name}`).join('<br>')}
                        `);
                    }
                }

            } catch (error) {
                addStatus('storage-results', 'error', `
                    âŒ Storage íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨<br>
                    <strong>ì˜¤ë¥˜:</strong> ${error.message}<br>
                    <pre>${error.stack}</pre>
                `);
            }
        }

        async function testAudioDownload() {
            clearResults('audio-download-results');
            
            try {
                addStatus('audio-download-results', 'info', 'ğŸµ í…ŒìŠ¤íŠ¸ ìŒì› URL ê°€ì ¸ì˜¤ëŠ” ì¤‘...');
                
                // ë¨¼ì € íŒŒì¼ ëª©ë¡ì„ ê°€ì ¸ì™€ì„œ ì²« ë²ˆì§¸ íŒŒì¼ë¡œ í…ŒìŠ¤íŠ¸
                const trackRef = window.ref(window.storage, 'track');
                const trackList = await window.listAll(trackRef);
                
                if (trackList.items.length === 0) {
                    addStatus('audio-download-results', 'warning', 'âš ï¸ í…ŒìŠ¤íŠ¸í•  ìŒì› íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const firstFile = trackList.items[0];
                const downloadURL = await window.getDownloadURL(firstFile);
                
                addStatus('audio-download-results', 'success', `
                    âœ… ìŒì› URL ìƒì„± ì„±ê³µ<br>
                    <strong>íŒŒì¼:</strong> ${firstFile.name}<br>
                    <strong>URL:</strong> <a href="${downloadURL}" target="_blank" style="color: #4499ff;">${downloadURL.substring(0, 80)}...</a>
                `);

                // ì‹¤ì œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸
                const response = await fetch(downloadURL, { method: 'HEAD' });
                addStatus('audio-download-results', 'success', `
                    âœ… íŒŒì¼ ì ‘ê·¼ ì„±ê³µ<br>
                    <strong>ìƒíƒœ:</strong> ${response.status} ${response.statusText}<br>
                    <strong>Content-Type:</strong> ${response.headers.get('content-type')}<br>
                    <strong>Content-Length:</strong> ${response.headers.get('content-length')} bytes
                `);

                // HTML5 Audioë¡œ í…ŒìŠ¤íŠ¸
                const audio = new Audio(downloadURL);
                audio.addEventListener('loadedmetadata', () => {
                    addStatus('audio-download-results', 'success', `
                        âœ… HTML5 Audio ë¡œë“œ ì„±ê³µ<br>
                        <strong>ì¬ìƒ ì‹œê°„:</strong> ${audio.duration.toFixed(2)}ì´ˆ
                    `);
                });
                audio.addEventListener('error', (e) => {
                    addStatus('audio-download-results', 'error', `
                        âŒ HTML5 Audio ë¡œë“œ ì‹¤íŒ¨<br>
                        <strong>ì˜¤ë¥˜:</strong> ${e.target.error.message}
                    `);
                });

            } catch (error) {
                addStatus('audio-download-results', 'error', `
                    âŒ ìŒì› ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨<br>
                    <strong>ì˜¤ë¥˜:</strong> ${error.message}<br>
                    <pre>${error.stack}</pre>
                `);
            }
        }

        async function testWaveSurfer() {
            clearResults('wavesurfer-results');
            
            try {
                addStatus('wavesurfer-results', 'info', 'ğŸŒŠ WaveSurfer ì´ˆê¸°í™” ì¤‘...');
                
                // WaveSurfer ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
                const container = document.getElementById('waveform-test');
                container.innerHTML = ''; // ì´ì „ ë‚´ìš© ì •ë¦¬
                
                const wavesurfer = window.WaveSurfer.create({
                    container: container,
                    waveColor: 'rgba(255, 255, 255, 0.6)',
                    progressColor: '#ff6b35',
                    height: 60,
                    barWidth: 2,
                    barGap: 1,
                    cursorWidth: 0,
                    interact: true,
                    normalize: true
                });

                addStatus('wavesurfer-results', 'success', 'âœ… WaveSurfer ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì„±ê³µ');

                // í…ŒìŠ¤íŠ¸ ìŒì› ë¡œë“œ
                const trackRef = window.ref(window.storage, 'track');
                const trackList = await window.listAll(trackRef);
                
                if (trackList.items.length > 0) {
                    const testFile = trackList.items[0];
                    const downloadURL = await window.getDownloadURL(testFile);
                    
                    wavesurfer.on('ready', () => {
                        addStatus('wavesurfer-results', 'success', `
                            âœ… WaveSurfer ìŒì› ë¡œë“œ ì„±ê³µ<br>
                            <strong>íŒŒì¼:</strong> ${testFile.name}<br>
                            <strong>ì¬ìƒ ì‹œê°„:</strong> ${wavesurfer.getDuration().toFixed(2)}ì´ˆ
                        `);
                    });

                    wavesurfer.on('error', (error) => {
                        addStatus('wavesurfer-results', 'error', `
                            âŒ WaveSurfer ë¡œë“œ ì‹¤íŒ¨<br>
                            <strong>ì˜¤ë¥˜:</strong> ${error.message}
                        `);
                    });

                    wavesurfer.load(downloadURL);
                } else {
                    addStatus('wavesurfer-results', 'warning', 'âš ï¸ í…ŒìŠ¤íŠ¸í•  ìŒì› íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                addStatus('wavesurfer-results', 'error', `
                    âŒ WaveSurfer í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨<br>
                    <strong>ì˜¤ë¥˜:</strong> ${error.message}<br>
                    <pre>${error.stack}</pre>
                `);
            }
        }

        async function testDirectAudio() {
            clearResults('direct-audio-results');
            
            try {
                addStatus('direct-audio-results', 'info', 'ğŸ§ HTML5 Audio í…ŒìŠ¤íŠ¸ ì¤‘...');
                
                // í…ŒìŠ¤íŠ¸ ìŒì› ê°€ì ¸ì˜¤ê¸°
                const trackRef = window.ref(window.storage, 'track');
                const trackList = await window.listAll(trackRef);
                
                if (trackList.items.length === 0) {
                    addStatus('direct-audio-results', 'warning', 'âš ï¸ í…ŒìŠ¤íŠ¸í•  ìŒì› íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const testFile = trackList.items[0];
                const downloadURL = await window.getDownloadURL(testFile);
                
                // HTML5 Audio ìš”ì†Œ ìƒì„±
                const audio = document.createElement('audio');
                audio.controls = true;
                audio.src = downloadURL;
                
                const audioContainer = document.createElement('div');
                audioContainer.innerHTML = `<strong>í…ŒìŠ¤íŠ¸ íŒŒì¼:</strong> ${testFile.name}<br>`;
                audioContainer.appendChild(audio);
                
                document.getElementById('direct-audio-results').appendChild(audioContainer);
                
                audio.addEventListener('loadedmetadata', () => {
                    addStatus('direct-audio-results', 'success', `
                        âœ… HTML5 Audio ë¡œë“œ ì„±ê³µ<br>
                        <strong>ì¬ìƒ ì‹œê°„:</strong> ${audio.duration.toFixed(2)}ì´ˆ<br>
                        ìœ„ì˜ í”Œë ˆì´ì–´ë¡œ ìŒì›ì„ ì¬ìƒí•´ë³´ì„¸ìš”.
                    `);
                });

                audio.addEventListener('error', (e) => {
                    addStatus('direct-audio-results', 'error', `
                        âŒ HTML5 Audio ë¡œë“œ ì‹¤íŒ¨<br>
                        <strong>ì˜¤ë¥˜ ì½”ë“œ:</strong> ${e.target.error.code}<br>
                        <strong>ì˜¤ë¥˜ ë©”ì‹œì§€:</strong> ${e.target.error.message}
                    `);
                });

                audio.addEventListener('canplay', () => {
                    addStatus('direct-audio-results', 'success', 'âœ… ìŒì› ì¬ìƒ ì¤€ë¹„ ì™„ë£Œ');
                });

            } catch (error) {
                addStatus('direct-audio-results', 'error', `
                    âŒ HTML5 Audio í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨<br>
                    <strong>ì˜¤ë¥˜:</strong> ${error.message}<br>
                    <pre>${error.stack}</pre>
                `);
            }
        }
    </script>
</body>
</html>
